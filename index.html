<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantasy Runner</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb;}
canvas{display:block;margin:0 auto;}
.controls{
 position:fixed;
 bottom:15px;
 left:50%;
 transform:translateX(-50%);
 display:flex;
 gap:30px;
}
button{
 width:70px;
 height:70px;
 font-size:24px;
 border-radius:50%;
}
#rotateMessage{
 position:fixed;
 top:0;left:0;
 width:100%;height:100%;
 background:black;color:white;
 display:none;justify-content:center;
 align-items:center;text-align:center;
 font-size:24px;z-index:999;
}
</style>
</head>
<body>

<div id="rotateMessage">ğŸ“± ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”</div>
<canvas id="game"></canvas>

<div class="controls">
<button id="left">â¬…ï¸</button>
<button id="jumpBtn">â¬†ï¸</button>
<button id="right">â¡ï¸</button>
</div>

<script>
/* ===== í•´ìƒë„ ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const W=1000,H=600;
canvas.width=W; canvas.height=H;
canvas.style.width="100vw";
canvas.style.height="100vh";

/* ===== ë°©í–¥ ===== */
function checkOrientation(){
 if(window.innerHeight>window.innerWidth)
  rotateMessage.style.display="flex";
 else rotateMessage.style.display="none";
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* ===== ë³€ìˆ˜ ===== */
let gravity=0.45;
let stage=1,score=0,totalScore=0;
let spacing=450,gameSpeed=3;
let health=3,invincible=false,invTimer=0;
let gameActive=true,gameOver=false,ending=false;
let keys={left:false,right:false};
let obstacles=[],items=[];

/* ===== í”Œë ˆì´ì–´ ===== */
let player={
 x:200,y:H-150,
 width:60,height:60,
 velocityY:0,speed:6,jumpCount:0
};

/* ===== ì´ˆê¸°í™” ===== */
function initGame(){
 stage=1; totalScore=0; health=3;
 gameOver=false; ending=false; gameActive=true;
 startStage();
}

function startStage(){
 score=0; obstacles=[]; items=[];
 spacing=520-stage*25; if(spacing<260) spacing=260;
 gameSpeed=2+stage;
 player.y=H-150; player.velocityY=0; player.jumpCount=0;
}

initGame();

/* ===== ì…ë ¥ ===== */
function jump(){
 if(gameOver){initGame();return;}
 if(!gameActive)return;

 if(player.jumpCount<3){
  if(player.jumpCount===0) player.velocityY=-18;
  else if(player.jumpCount===1) player.velocityY=-17;
  else player.velocityY=-15;
  player.jumpCount++;
 }
}

document.addEventListener("keydown",e=>{
 if(e.key==="ArrowLeft")keys.left=true;
 if(e.key==="ArrowRight")keys.right=true;
 if(e.key===" "||e.key==="ArrowUp")jump();
});
document.addEventListener("keyup",e=>{
 if(e.key==="ArrowLeft")keys.left=false;
 if(e.key==="ArrowRight")keys.right=false;
});
left.ontouchstart=()=>keys.left=true;
left.ontouchend=()=>keys.left=false;
right.ontouchstart=()=>keys.right=true;
right.ontouchend=()=>keys.right=false;
jumpBtn.ontouchstart=jump;

/* ===== ìƒì„± ===== */
function spawnObstacle(){
 if(obstacles.length>=10)return;
 let type=obstacles.length<5?"tree":"monster";
 let height=type==="tree"?120:200;
 let lastX=obstacles.length?obstacles[obstacles.length-1].x:W;
 obstacles.push({
  x:lastX+spacing,
  y:H-50-height,
  width:80,height:height,
  type:type,passed:false,hit:false
 });
}

function spawnItem(){
 if(Math.random()<0.02){
  let type=Math.random()<0.5?"heart":"shield";
  items.push({
   x:W+100,
   y:Math.random()*(H-200),
   type:type
  });
 }
}

/* ===== ì—…ë°ì´íŠ¸ ===== */
function update(){
 if(!gameActive)return;

 if(keys.left)player.x-=player.speed;
 if(keys.right)player.x+=player.speed;
 if(player.x<0)player.x=0;
 if(player.x+player.width>W)
  player.x=W-player.width;

 player.velocityY+=gravity;
 player.y+=player.velocityY;
 if(player.y+player.height>=H-50){
  player.y=H-50-player.height;
  player.jumpCount=0;
 }

 if(invincible){
  invTimer--; if(invTimer<=0)invincible=false;
 }

 if(obstacles.length===0 ||
   obstacles[obstacles.length-1].x<W-spacing)
  spawnObstacle();

 spawnItem();

 obstacles.forEach(obj=>{
  obj.x-=gameSpeed;

  if(player.x<obj.x+80 &&
     player.x+60>obj.x &&
     player.y<obj.y+obj.height &&
     player.y+60>obj.y){
   if(!obj.hit&&!invincible){
    obj.hit=true; health--;
    if(health<=0){gameOver=true;gameActive=false;}
   }
  }

  if(!obj.passed&&obj.x+80<player.x){
   obj.passed=true; score++; totalScore++;
  }
 });

 items.forEach(it=>{
  it.x-=gameSpeed;
  if(player.x<it.x+30 &&
     player.x+60>it.x &&
     player.y<it.y+30 &&
     player.y+60>it.y){
   if(it.type==="heart"&&health<3)health++;
   if(it.type==="shield"){invincible=true;invTimer=180;}
   it.remove=true;
  }
 });
 items=items.filter(i=>!i.remove);

 if(score>=10){
  stage++;
  if(stage>10){ending=true;gameActive=false;}
  else startStage();
 }
}

/* ===== ê·¸ë¦¬ê¸° ===== */
function draw(){
 ctx.clearRect(0,0,W,H);

 if(ending){
  ctx.fillStyle="black"; ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("THE END",400,250);
  ctx.font="30px Arial";
  ctx.fillText("Final Score: "+totalScore,380,300);
  return;
 }

 if(gameOver){
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("GAME OVER",380,250);
  ctx.font="25px Arial";
  ctx.fillText("Tap to Restart",430,300);
  return;
 }

 ctx.fillStyle="green";
 ctx.fillRect(0,H-50,W,50);

 /* í”Œë ˆì´ì–´ */
 if(invincible)
  ctx.globalAlpha=0.5+Math.sin(Date.now()*0.02)*0.5;

 ctx.fillStyle="#ffcc99";
 ctx.beginPath();
 ctx.arc(player.x+30,player.y+30,30,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="black";
 ctx.beginPath();
 ctx.arc(player.x+20,player.y+25,5,0,Math.PI*2);
 ctx.arc(player.x+40,player.y+25,5,0,Math.PI*2);
 ctx.fill();
 ctx.beginPath();
 ctx.arc(player.x+30,player.y+35,10,0,Math.PI);
 ctx.stroke();
 ctx.globalAlpha=1;

 /* ì¥ì• ë¬¼ */
 obstacles.forEach(obj=>{
  if(obj.type==="tree"){
   ctx.fillStyle="#6b3e26";
   ctx.fillRect(obj.x+30,obj.y+60,20,obj.height-60);
   ctx.fillStyle="#0b6623";
   ctx.beginPath();
   ctx.moveTo(obj.x+40,obj.y);
   ctx.lineTo(obj.x,obj.y+80);
   ctx.lineTo(obj.x+80,obj.y+80);
   ctx.closePath(); ctx.fill();
  }else{
   let cx=obj.x+40,cy=obj.y+100;
   ctx.fillStyle="#4b0082";
   ctx.beginPath();
   ctx.ellipse(cx,cy,40,80,0,0,Math.PI*2);
   ctx.fill();

   ctx.fillStyle="white";
   ctx.beginPath();
   ctx.arc(cx-15,cy-30,10,0,Math.PI*2);
   ctx.arc(cx+15,cy-30,10,0,Math.PI*2);
   ctx.fill();

   ctx.fillStyle="black";
   ctx.beginPath();
   ctx.arc(cx-15,cy-30,5,0,Math.PI*2);
   ctx.arc(cx+15,cy-30,5,0,Math.PI*2);
   ctx.fill();

   ctx.fillStyle="black";
   ctx.beginPath();
   ctx.arc(cx,cy+10,20,0,Math.PI);
   ctx.fill();
  }
 });

 /* ì•„ì´í…œ */
 items.forEach(it=>{
  ctx.fillStyle=it.type==="heart"?"red":"gold";
  ctx.beginPath();
  ctx.arc(it.x+15,it.y+15,15,0,Math.PI*2);
  ctx.fill();
 });

 ctx.fillStyle="black";
 ctx.font="20px Arial";
 ctx.fillText("Stage:"+stage,20,30);
 ctx.fillText("HP:"+health,20,60);
}

/* ===== ë£¨í”„ ===== */
function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
