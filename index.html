<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantasy Runner</title>
<style>
body{margin:0;overflow:hidden;background:black;}
canvas{display:block;margin:0 auto;background:#87ceeb;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const WIDTH=1000;
const HEIGHT=600;

canvas.width=WIDTH;
canvas.height=HEIGHT;
canvas.style.width="100vw";
canvas.style.height="100vh";

let state="intro";

let score=0;
let health=3;
let gameSpeed=4;

let obstacles=[];
let spawnTimer=0;
let spawnDelay=120;

let invincible=false;
let invTimer=0;

/* ================= PLAYER ================= */

class Player{
 constructor(){
  this.x=200;
  this.width=60;
  this.height=80;
  this.y=HEIGHT-50-this.height;

  this.vy=0;
  this.gravity=0.45;
  this.maxFall=9;
  this.jumpCount=0;
  this.runFrame=0;
 }

 update(){
  this.runFrame+=0.25;

  this.vy+=this.gravity;
  if(this.vy>this.maxFall) this.vy=this.maxFall;

  this.y+=this.vy;

  if(this.y+this.height>=HEIGHT-50){
   this.y=HEIGHT-50-this.height;
   this.vy=0;
   this.jumpCount=0;
  }
 }

 jump(){
  if(this.jumpCount<2){
   this.vy=-14;
   this.jumpCount++;
  }
 }

 draw(){

  if(invincible) ctx.globalAlpha=0.6;

  // 그림자
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.beginPath();
  ctx.ellipse(this.x+30,HEIGHT-40,30,12,0,0,Math.PI*2);
  ctx.fill();

  ctx.save();
  ctx.translate(this.x+30,this.y+40);

  if(this.vy!==0){
   ctx.rotate(this.vy*0.03);
  }

  ctx.translate(-(this.x+30),-(this.y+40));

  // 몸통
  ctx.fillStyle="#2ecc71";
  ctx.fillRect(this.x+15,this.y+35,30,35);

  // 머리
  ctx.fillStyle="#ffcc99";
  ctx.beginPath();
  ctx.arc(this.x+30,this.y+20,20,0,Math.PI*2);
  ctx.fill();

  // 눈
  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.arc(this.x+23,this.y+18,3,0,Math.PI*2);
  ctx.arc(this.x+37,this.y+18,3,0,Math.PI*2);
  ctx.fill();

  // 다리 애니메이션
  let leg=Math.sin(this.runFrame)*8;

  ctx.strokeStyle="#222";
  ctx.lineWidth=4;

  ctx.beginPath();
  ctx.moveTo(this.x+25,this.y+70);
  ctx.lineTo(this.x+25+leg,this.y+90);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(this.x+35,this.y+70);
  ctx.lineTo(this.x+35-leg,this.y+90);
  ctx.stroke();

  ctx.restore();
  ctx.globalAlpha=1;
 }
}

let player=new Player();

/* ================= OBSTACLE ================= */

class Obstacle{
 constructor(){
  this.width=60;
  this.height=Math.random()>0.5?80:50;
  this.x=WIDTH+Math.random()*300+200;
  this.y=HEIGHT-50-this.height;
 }

 update(){ this.x-=gameSpeed; }

 draw(){
  ctx.fillStyle="#8e44ad";
  ctx.fillRect(this.x,this.y,this.width,this.height);
 }
}

/* ================= INPUT ================= */

canvas.addEventListener("touchend",()=>{
 if(state==="intro"){ state="play"; return; }
 if(state==="play") player.jump();
});

document.addEventListener("keydown",e=>{
 if(e.code==="Space"){
  if(state==="intro"){ state="play"; return; }
  if(state==="play") player.jump();
 }
});

/* ================= UPDATE ================= */

function update(){
 if(state!=="play") return;

 player.update();

 if(spawnDelay>0){
  spawnDelay--;
 }else{
  spawnTimer++;
  if(spawnTimer>90){
   obstacles.push(new Obstacle());
   spawnTimer=0;
  }
 }

 obstacles.forEach(o=>o.update());

 obstacles.forEach(o=>{
  if(player.x<o.x+o.width &&
     player.x+player.width>o.x &&
     player.y<o.y+o.height &&
     player.y+player.height>o.y &&
     !invincible){

   health--;
   invincible=true;
   invTimer=60;

   if(health<=0) state="gameover";
  }
 });

 obstacles=obstacles.filter(o=>o.x>-100);

 if(invincible){
  invTimer--;
  if(invTimer<=0) invincible=false;
 }
}

/* ================= DRAW ================= */

function draw(){
 ctx.clearRect(0,0,WIDTH,HEIGHT);

 if(state==="intro"){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,WIDTH,HEIGHT);
  ctx.fillStyle="white";
  ctx.font="40px Arial";
  ctx.fillText("TAP OR SPACE TO START",260,300);
  return;
 }

 if(state==="gameover"){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,WIDTH,HEIGHT);
  ctx.fillStyle="red";
  ctx.font="50px Arial";
  ctx.fillText("GAME OVER",330,280);
  return;
 }

 ctx.fillStyle="#87ceeb";
 ctx.fillRect(0,0,WIDTH,HEIGHT);

 ctx.fillStyle="green";
 ctx.fillRect(0,HEIGHT-50,WIDTH,50);

 obstacles.forEach(o=>o.draw());

 player.draw();

 for(let i=0;i<health;i++){
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(900+i*30,30,10,0,Math.PI*2);
  ctx.fill();
 }
}

/* ================= LOOP ================= */

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
