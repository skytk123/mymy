<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fantasy Runner Full Stretch</title>
<style>
html,body{
 margin:0;
 padding:0;
 overflow:hidden;
 background:#87ceeb;
}
canvas{
 width:100vw;
 height:100vh;
 display:block;
 background:#87ceeb;

 transform:scale(0.8);
 transform-origin:center center;
}
#rotateMessage{
 position:fixed;
 top:0;left:0;
 width:100%;height:100%;
 background:black;
 color:white;
 display:none;
 justify-content:center;
 align-items:center;
 font-size:24px;
 z-index:999;
}
</style>
</head>
<body>

<div id="rotateMessage">üì± Í∞ÄÎ°úÎ°ú ÎèåÎ†§Ï£ºÏÑ∏Ïöî</div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

/* ÎÇ¥Î∂Ä Í≤åÏûÑ Ï¢åÌëú Í≥†Ï†ï */
const W=1000;
const H=600;
canvas.width=W;
canvas.height=H;

/* Î∞©Ìñ• Ï≤¥ÌÅ¨ */
function checkOrientation(){
 if(window.innerHeight>window.innerWidth)
  rotateMessage.style.display="flex";
 else
  rotateMessage.style.display="none";
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* ===== Í≤åÏûÑ Î≥ÄÏàò ===== */
let gravity=0.45;
let stage=1,score=0,totalScore=0;
let spacing=450,gameSpeed=3;
let health=3;
let invincible=false,invTimer=0;
let gameActive=true,gameOver=false,ending=false;
let obstacles=[],items=[],clouds=[];
let highScore=localStorage.getItem("highScore")||0;
let audioCtx=null;

let player={
 x:200,
 y:H-150,
 width:60,
 height:60,
 velocityY:0,
 jumpCount:0
};

/* ===== Ï¥àÍ∏∞Ìôî ===== */
function initClouds(){
 clouds=[];
 for(let i=0;i<5;i++){
  clouds.push({
   x:Math.random()*W,
   y:Math.random()*200,
   speed:1+Math.random()*1.5
  });
 }
}

function initGame(){
 stage=1;
 totalScore=0;
 health=3;
 gameOver=false;
 ending=false;
 gameActive=true;
 startStage();
 initClouds();
}

function startStage(){
 score=0;
 obstacles=[];
 items=[];
 spacing=520-stage*25;
 if(spacing<260)spacing=260;
 gameSpeed=2+stage;
 player.y=H-150;
 player.velocityY=0;
 player.jumpCount=0;
}

initGame();

/* ===== Ï†êÌîÑ ===== */
function jump(){
 if(gameOver){initGame();return;}
 if(!gameActive)return;

 if(player.jumpCount<3){
  if(player.jumpCount===0)player.velocityY=-18;
  else if(player.jumpCount===1)player.velocityY=-17;
  else player.velocityY=-15;
  player.jumpCount++;
 }

 if(!audioCtx)
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
 let osc=audioCtx.createOscillator();
 osc.type="square";
 osc.frequency.value=300;
 osc.connect(audioCtx.destination);
 osc.start();
 osc.stop(audioCtx.currentTime+0.1);
}

document.addEventListener("keydown",e=>{
 if(e.key===" "||e.key==="ArrowUp")jump();
});
canvas.addEventListener("touchstart",e=>{
 e.preventDefault();
 jump();
});
canvas.addEventListener("mousedown",jump);

/* ===== ÏÉùÏÑ± ===== */
function spawnObstacle(){
 if(obstacles.length>=10)return;

 let type=obstacles.length<5?"tree":"monster";
 let height=type==="tree"?120:200;
 let lastX=obstacles.length?obstacles[obstacles.length-1].x:W;

 obstacles.push({
  x:lastX+spacing,
  y:H-50-height,
  width:80,
  height:height,
  type:type,
  passed:false,
  hit:false
 });
}

function spawnItem(){
 if(Math.random()<0.02){
  let type=Math.random()<0.5?"heart":"shield";
  items.push({
   x:W+100,
   y:Math.random()*(H-200),
   type:type
  });
 }
}

/* ===== ÏóÖÎç∞Ïù¥Ìä∏ ===== */
function update(){
 if(!gameActive)return;

 player.velocityY+=gravity;
 player.y+=player.velocityY;

 if(player.y+player.height>=H-50){
  player.y=H-50-player.height;
  player.jumpCount=0;
 }

 if(invincible){
  invTimer--;
  if(invTimer<=0)invincible=false;
 }

 clouds.forEach(c=>{
  c.x-=c.speed;
  if(c.x<-100){
   c.x=W+100;
   c.y=Math.random()*200;
  }
 });

 if(obstacles.length===0||
   obstacles[obstacles.length-1].x<W-spacing)
  spawnObstacle();

 spawnItem();

 obstacles.forEach(obj=>{
  obj.x-=gameSpeed;

  if(player.x<obj.x+80 &&
     player.x+60>obj.x &&
     player.y<obj.y+obj.height &&
     player.y+60>obj.y){
   if(!obj.hit&&!invincible){
    obj.hit=true;
    health--;
    if(health<=0){
     gameOver=true;
     gameActive=false;
    }
   }
  }

  if(!obj.passed&&obj.x+80<player.x){
   obj.passed=true;
   score++;
   totalScore++;
   if(totalScore>highScore){
    highScore=totalScore;
    localStorage.setItem("highScore",highScore);
   }
  }
 });

 items.forEach(it=>{
  it.x-=gameSpeed;
  if(player.x<it.x+30 &&
     player.x+60>it.x &&
     player.y<it.y+30 &&
     player.y+60>it.y){
   if(it.type==="heart"&&health<3)health++;
   if(it.type==="shield"){
    invincible=true;
    invTimer=180;
   }
   it.remove=true;
  }
 });
 items=items.filter(i=>!i.remove);

 if(score>=10){
  stage++;
  if(stage>10){
   ending=true;
   gameActive=false;
  }else{
   startStage();
  }
 }
}

/* ===== Í∑∏Î¶¨Í∏∞ ===== */
function draw(){
 ctx.clearRect(0,0,W,H);

 if(ending){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("THE END",400,250);
  ctx.font="30px Arial";
  ctx.fillText("Final Score: "+totalScore,380,300);
  return;
 }

 if(gameOver){
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("GAME OVER",380,250);
  ctx.font="25px Arial";
  ctx.fillText("Tap to Restart",430,300);
  return;
 }

 clouds.forEach(c=>{
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(c.x,c.y,30,0,Math.PI*2);
  ctx.arc(c.x+30,c.y+10,25,0,Math.PI*2);
  ctx.arc(c.x-30,c.y+10,25,0,Math.PI*2);
  ctx.fill();
 });

 ctx.fillStyle="green";
 ctx.fillRect(0,H-50,W,50);

 ctx.fillStyle="#ffcc99";
 ctx.beginPath();
 ctx.arc(player.x+30,player.y+30,30,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="black";
 ctx.beginPath();
 ctx.arc(player.x+20,player.y+25,5,0,Math.PI*2);
 ctx.arc(player.x+40,player.y+25,5,0,Math.PI*2);
 ctx.fill();

 ctx.beginPath();
 ctx.arc(player.x+30,player.y+35,10,0,Math.PI);
 ctx.stroke();

 obstacles.forEach(obj=>{
  if(obj.type==="tree"){
   ctx.fillStyle="#6b3e26";
   ctx.fillRect(obj.x+30,obj.y+60,20,obj.height-60);

   ctx.fillStyle="#0b6623";
   ctx.beginPath();
   ctx.moveTo(obj.x+40,obj.y);
   ctx.lineTo(obj.x,obj.y+80);
   ctx.lineTo(obj.x+80,obj.y+80);
   ctx.closePath();
   ctx.fill();
  }else{
   ctx.fillStyle="#4b0082";
   ctx.fillRect(obj.x,obj.y,obj.width,obj.height);
  }
 });

 items.forEach(it=>{
  ctx.fillStyle=it.type==="heart"?"red":"gold";
  ctx.beginPath();
  ctx.arc(it.x+15,it.y+15,15,0,Math.PI*2);
  ctx.fill();
 });

 ctx.fillStyle="black";
 ctx.font="20px Arial";
 ctx.fillText("Stage:"+stage,20,30);
 ctx.fillText("HP:"+health,20,60);
 ctx.fillText("High:"+highScore,20,90);
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>


