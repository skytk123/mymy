<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantasy Runner Ultimate</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb;}
canvas{display:block;margin:0 auto;}
.controls{
 position:fixed;
 bottom:15px;
 left:50%;
 transform:translateX(-50%);
 display:flex;
 gap:30px;
}
button{
 width:70px;height:70px;
 font-size:24px;border-radius:50%;
}
#rotateMessage{
 position:fixed;top:0;left:0;
 width:100%;height:100%;
 background:black;color:white;
 display:none;justify-content:center;
 align-items:center;text-align:center;
 font-size:24px;z-index:999;
}
</style>
</head>
<body>

<div id="rotateMessage">ğŸ“± ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”</div>
<canvas id="game"></canvas>

<div class="controls">
<button id="left">â¬…ï¸</button>
<button id="jumpBtn">â¬†ï¸</button>
<button id="right">â¡ï¸</button>
</div>

<script>
/* ===== ê¸°ë³¸ ì„¤ì • ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const W=1000,H=600;
canvas.width=W;canvas.height=H;
canvas.style.width="100vw";
canvas.style.height="100vh";

/* ===== ë°©í–¥ ì²´í¬ ===== */
function checkOrientation(){
 if(window.innerHeight>window.innerWidth)
  rotateMessage.style.display="flex";
 else rotateMessage.style.display="none";
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* ===== ë³€ìˆ˜ ===== */
let gravity=0.45;
let stage=1,score=0,totalScore=0;
let spacing=450,gameSpeed=3;
let health=3,invincible=false,invTimer=0;
let gameActive=true,gameOver=false,ending=false;
let keys={left:false,right:false};
let obstacles=[],items=[];
let clouds=[];
let highScore=localStorage.getItem("highScore")||0;
let audioCtx=null;

/* ===== í”Œë ˆì´ì–´ ===== */
let player={
 x:200,y:H-150,
 width:60,height:60,
 velocityY:0,speed:6,jumpCount:0
};

/* ===== ì´ˆê¸°í™” ===== */
function initClouds(){
 clouds=[];
 for(let i=0;i<5;i++){
  clouds.push({
   x:Math.random()*W,
   y:Math.random()*200,
   speed:1+Math.random()*1.5
  });
 }
}

function initGame(){
 stage=1;totalScore=0;health=3;
 gameOver=false;ending=false;gameActive=true;
 startStage();initClouds();
}

function startStage(){
 score=0;obstacles=[];items=[];
 spacing=520-stage*25;if(spacing<260)spacing=260;
 gameSpeed=2+stage;
 player.y=H-150;player.velocityY=0;player.jumpCount=0;
}

initGame();

/* ===== ì…ë ¥ ===== */
function jump(){
 if(gameOver){initGame();return;}
 if(!gameActive)return;

 if(player.jumpCount<3){
  if(player.jumpCount===0)player.velocityY=-18;
  else if(player.jumpCount===1)player.velocityY=-17;
  else player.velocityY=-15;
  player.jumpCount++;
 }

 // íš¨ê³¼ìŒ
 if(!audioCtx)audioCtx=new (window.AudioContext||window.webkitAudioContext)();
 let osc=audioCtx.createOscillator();
 osc.type="square";
 osc.frequency.value=300;
 osc.connect(audioCtx.destination);
 osc.start();
 osc.stop(audioCtx.currentTime+0.1);
}

document.addEventListener("keydown",e=>{
 if(e.key==="ArrowLeft")keys.left=true;
 if(e.key==="ArrowRight")keys.right=true;
 if(e.key===" "||e.key==="ArrowUp")jump();
});
document.addEventListener("keyup",e=>{
 if(e.key==="ArrowLeft")keys.left=false;
 if(e.key==="ArrowRight")keys.right=false;
});
left.ontouchstart=()=>keys.left=true;
left.ontouchend=()=>keys.left=false;
right.ontouchstart=()=>keys.right=true;
right.ontouchend=()=>keys.right=false;
jumpBtn.ontouchstart=jump;

/* ===== ìƒì„± ===== */
function spawnObstacle(){
 if(obstacles.length>=10)return;
 let type=obstacles.length<5?"tree":"monster";
 let height=type==="tree"?120:200;
 let lastX=obstacles.length?obstacles[obstacles.length-1].x:W;
 obstacles.push({
  x:lastX+spacing,
  y:H-50-height,
  width:80,height:height,
  type:type,passed:false,hit:false
 });
}

function spawnItem(){
 if(Math.random()<0.02){
  let type=Math.random()<0.5?"heart":"shield";
  items.push({
   x:W+100,
   y:Math.random()*(H-200),
   type:type
  });
 }
}

/* ===== ì—…ë°ì´íŠ¸ ===== */
function update(){
 if(!gameActive)return;

 if(keys.left)player.x-=player.speed;
 if(keys.right)player.x+=player.speed;
 if(player.x<0)player.x=0;
 if(player.x+player.width>W)player.x=W-player.width;

 player.velocityY+=gravity;
 player.y+=player.velocityY;
 if(player.y+player.height>=H-50){
  player.y=H-50-player.height;
  player.jumpCount=0;
 }

 if(invincible){invTimer--;if(invTimer<=0)invincible=false;}

 clouds.forEach(c=>{
  c.x-=c.speed;
  if(c.x<-100){c.x=W+100;c.y=Math.random()*200;}
 });

 if(obstacles.length===0||
   obstacles[obstacles.length-1].x<W-spacing)
  spawnObstacle();

 spawnItem();

 obstacles.forEach(obj=>{
  obj.x-=gameSpeed;
  if(player.x<obj.x+80 &&
     player.x+60>obj.x &&
     player.y<obj.y+obj.height &&
     player.y+60>obj.y){
   if(!obj.hit&&!invincible){
    obj.hit=true;health--;
    if(health<=0){gameOver=true;gameActive=false;}
   }
  }
  if(!obj.passed&&obj.x+80<player.x){
   obj.passed=true;score++;totalScore++;
   if(totalScore>highScore){
    highScore=totalScore;
    localStorage.setItem("highScore",highScore);
   }
  }
 });

 items.forEach(it=>{
  it.x-=gameSpeed;
  if(player.x<it.x+30 &&
     player.x+60>it.x &&
     player.y<it.y+30 &&
     player.y+60>it.y){
   if(it.type==="heart"&&health<3)health++;
   if(it.type==="shield"){invincible=true;invTimer=180;}
   it.remove=true;
  }
 });
 items=items.filter(i=>!i.remove);

 if(score>=10){
  stage++;
  if(stage>10){ending=true;gameActive=false;}
  else startStage();
 }
}

/* ===== ê·¸ë¦¬ê¸° ===== */
function draw(){
 ctx.clearRect(0,0,W,H);

 if(ending){
  ctx.fillStyle="black";ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("THE END",400,250);
  ctx.font="30px Arial";
  ctx.fillText("Final Score: "+totalScore,380,300);
  ctx.fillText("High Score: "+highScore,380,340);
  return;
 }

 if(gameOver){
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle="white";
  ctx.font="50px Arial";
  ctx.fillText("GAME OVER",380,250);
  ctx.font="25px Arial";
  ctx.fillText("Tap to Restart",430,300);
  return;
 }

 /* êµ¬ë¦„ */
 clouds.forEach(c=>{
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(c.x,c.y,30,0,Math.PI*2);
  ctx.arc(c.x+30,c.y+10,25,0,Math.PI*2);
  ctx.arc(c.x-30,c.y+10,25,0,Math.PI*2);
  ctx
